image: lukasheinrich/recast_cvmfs_assisted

stages:
  - build
  - test

before_script:
   - source setup.sh #sources the setup IN the TREXfitter package (consistent with user's setup)
   - root -l -b -q 

# image: docker.cern.ch/linuxsupport/cc7-base:latest
#
# ##
# ## The sequence of tests to be done
# ##
# stages:
#    - prepare
#    - hstep
#    - wstep
#    - flsstep
#    - cleanup
#
# ##
# ## Common setup to be done for ALL jobs
# ##
# before_script:
#    - yum -y groupinstall "Development Tools" #install libraries and tools needed (gcc, make, ...)
#    - yum -y install libSM libX11 libXext libXpm libXft man #more modules to be used
#    - set +e
#    - source setup.sh #sources the setup IN the TREXfitter package (consistent with user's setup)
#    - which root #checks root exists
#    - which make #checks make exists
#    - root -l -b -q #checks root works
#    - ls #checks the content of the folder
#
# ##
# ## "Prepare" step: first compiles the code
# ##    Artifact: keeps the log file of the compilation
# ##
# compile:
#    stage: prepare
#    tags:
#      - cvmfs #explicitly asks the runner to have access to cvmfs
#    script:
#      - make clean #make sure we don't have residual compilation results
#      - make > make.log 2>&1 #dump the log files
#    artifacts:
#      paths:
#        - make.log
#        - myFit.exe
#
# ##
# ## "Prepare" step: in parallel, dumps the inputs of the test
# ##    Artifact: keeps the ExampleInputs folder
# ##
# input_prod:
#     stage: prepare
#     tags:
#       - cvmfs
#     script:
#       - root -l -b -q CreateHistograms.C
#       - ls -lrth ExampleInputs
#     artifacts:
#       paths:
#         - ExampleInputs
#
# ##
# ## "Hstep" step: produces the TRExFitter
# ##    Artifact: keeps the FitExample folder
# ##
# hstep:
#     stage: hstep
#     tags:
#       - cvmfs
#     script:
#       - ./myFit.exe h config/myFit.config
#       - ls
#       - ls FitExample/Histograms/
#     artifacts:
#       paths:
#         - FitExample
#
# ##
# ## "Wsetp" step: produces the workspace
# ##    Artifact: keeps the FitExample folder
# ##
# wstep:
#     stage: wstep
#     tags:
#       - cvmfs
#     script:
#       - ./myFit.exe w config/myFit.config
#       - ls
#       - ls FitExample
#       - ls FitExample/RooStats/
#     artifacts:
#       paths:
#         - FitExample
#
# ##
# ## "flsstep" step: performs the fit
# ##    Artifact: keeps the FitExample folder
# ##
# fstep:
#     stage: flsstep
#     tags:
#       - cvmfs
#     script:
#       - ./myFit.exe f config/myFit.config
#       - ls
#       - ls FitExample
#       - ls FitExample/Fits/
#       - cat FitExample/Fits/*.txt
#     artifacts:
#       paths:
#         - FitExample
#
# ##
# ## "flsstep" step: compute the limits
# ##    Artifact: keeps the FitExample folder
# ##
# lstep:
#     stage: flsstep
#     tags:
#       - cvmfs
#     script:
#       - ./myFit.exe l config/myFit.config
#       - ls
#       - ls FitExample
#       - ls FitExample/Limits/
#     artifacts:
#       paths:
#         - FitExample
#
# ##
# ## "flsstep" step: compute the significance
# ##    Artifact: keeps the FitExample folder
# ##
# sstep:
#     stage: flsstep
#     tags:
#       - cvmfs
#     script:
#       - ./myFit.exe s config/myFit.config
#       - ls
#       - ls FitExample
#       - ls FitExample/Significance/
#     artifacts:
#       paths:
#         - FitExample
